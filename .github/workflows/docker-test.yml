name: Test Docker Hub Push

on:
  push:
    branches: [ main, master ]

env:
  REGISTRY: docker.io
  IMAGE_NAME: walidbenhamid1/impresslola-app

jobs:
  test-docker-push:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Debug - Check secrets
      run: |
        echo "🔍 Debug des secrets..."
        if [ -n "${{ secrets.DOCKER_USERNAME }}" ]; then
          echo "✅ DOCKER_USERNAME est défini"
        else
          echo "❌ DOCKER_USERNAME n'est PAS défini"
        fi
        
        if [ -n "${{ secrets.DOCKER_PASSWORD }}" ]; then
          echo "✅ DOCKER_PASSWORD est défini"
        else
          echo "❌ DOCKER_PASSWORD n'est PAS défini"
        fi

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Test Docker Hub login
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
      continue-on-error: true

    - name: Debug - Check Docker login
      run: |
        echo "🔍 Test de connexion Docker Hub..."
        docker info
        echo "Test de pull d'une image simple..."
        docker pull hello-world

    - name: Build Docker image (test)
      run: |
        echo "🔨 Construction de l'image Docker..."
        docker build -t ${{ env.IMAGE_NAME }}:test .
        echo "✅ Image construite avec succès!"

    - name: Test Docker push
      run: |
        echo "📤 Test de push vers Docker Hub..."
        docker push ${{ env.IMAGE_NAME }}:test
        echo "✅ Push réussi!"

    - name: Success message
      run: |
        echo "🎉 Test Docker Hub terminé avec succès!"
        echo "📋 Résumé:"
        echo "- Secrets configurés: ✅"
        echo "- Login Docker Hub: ✅"
        echo "- Build image: ✅"
        echo "- Push image: ✅" 