name: Test Docker Hub Push

on:
  push:
    branches: [ main, master ]

env:
  REGISTRY: docker.io
  IMAGE_NAME: walidbenhamid1/impresslola-app

jobs:
  test-docker-push:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Debug - Check secrets
      run: |
        echo "ğŸ” Debug des secrets..."
        if [ -n "${{ secrets.DOCKER_USERNAME }}" ]; then
          echo "âœ… DOCKER_USERNAME est dÃ©fini"
        else
          echo "âŒ DOCKER_USERNAME n'est PAS dÃ©fini"
        fi
        
        if [ -n "${{ secrets.DOCKER_PASSWORD }}" ]; then
          echo "âœ… DOCKER_PASSWORD est dÃ©fini"
        else
          echo "âŒ DOCKER_PASSWORD n'est PAS dÃ©fini"
        fi

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Test Docker Hub login
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
      continue-on-error: true

    - name: Debug - Check Docker login
      run: |
        echo "ğŸ” Test de connexion Docker Hub..."
        docker info
        echo "Test de pull d'une image simple..."
        docker pull hello-world

    - name: Build Docker image (test)
      run: |
        echo "ğŸ”¨ Construction de l'image Docker..."
        docker build -t ${{ env.IMAGE_NAME }}:test .
        echo "âœ… Image construite avec succÃ¨s!"

    - name: Test Docker push
      run: |
        echo "ğŸ“¤ Test de push vers Docker Hub..."
        docker push ${{ env.IMAGE_NAME }}:test
        echo "âœ… Push rÃ©ussi!"

    - name: Success message
      run: |
        echo "ğŸ‰ Test Docker Hub terminÃ© avec succÃ¨s!"
        echo "ğŸ“‹ RÃ©sumÃ©:"
        echo "- Secrets configurÃ©s: âœ…"
        echo "- Login Docker Hub: âœ…"
        echo "- Build image: âœ…"
        echo "- Push image: âœ…" 